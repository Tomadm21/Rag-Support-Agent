# Architecture Overview

## System Context (C4 Level 1)

The system mediates between Customer Users and Support Staff (via the AI Agent).

```mermaid
C4Context
  title System Context Diagram

  Person(customer, "Customer", "Submits support tickets")
  System(support_agent, "Support Agent System", "Classifies and attempts to resolve tickets")
  System_Ext(openai, "OpenAI API", "LLM Inference")
  System_Ext(weaviate, "Weaviate", "Vector Knowledge Base")

  Rel(customer, support_agent, "Chats with")
  Rel(support_agent, openai, "Inference Calls")
  Rel(support_agent, weaviate, "Context Retrieval")
```

## Container Architecture (C4 Level 2)

The application consists of a SPA frontend and a FastAPI backend orchestrating AI agents.

```mermaid
C4Container
  title Container Diagram

  Container(frontend, "Frontend", "React / Vite", "User Interface for Chat")
  Container(api, "Backend API", "FastAPI / Python", "Handles requests and orchestration")
  ContainerDb(weaviate, "Vector DB", "Weaviate", "Stores embeddings of technical docs")

  Rel(frontend, api, "HTTP/SSE", "REST / Streaming")
  Rel(api, weaviate, "gRPC/HTTP", "Query / Index")
```

## Component Architecture (C4 Level 3) - Backend

The backend is structured around a LangGraph state machine.

```mermaid
graph TB
  subgraph "FastAPI Layer"
    API[main.py]
  end

  subgraph "LangGraph Agent"
    Graph[create_support_graph]
    Classifier[QueryClassifier]
    Retriever[ContextRetriever]
    Generator[ResponseGenerator]
  end

  API --> Graph
  Graph --> Classifier
  Graph --> Retriever
  Graph --> Generator
```

## Key Design Decisions

1. **LangGraph State Machine**:
   - **Rationale**: Allows cyclic and conditional workflows (e.g., critique -> retry) which are hard to manage with linear chains.
   - **Trade-offs**: Slightly higher complexity than simple chains.

2. **Weaviate as Vector Store**:
   - **Rationale**: Production-ready, handles metadata filtering well (critical for category-scoped search).

3. **SSE for Streaming**:
   - **Rationale**: Native browser support, easier than WebSockets for uni-directional chat streams.
